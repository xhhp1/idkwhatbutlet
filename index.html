<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>💼الشؤون الإدارية💼</title>
<style>
  :root{
    --gold:#e0ca51;
    --bg:#222;
    --panel-bg: rgba(0,0,0,0.85);
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: Tahoma, Arial, sans-serif;
    background: url("https://raw.githubusercontent.com/xhhp1/mechanics/main/images/mechan.png") no-repeat center center fixed;
    background-size: cover;
    color:var(--gold);
    text-align:center;
    padding:20px;
    box-sizing:border-box;
  }
  h1{ margin:12px 0 18px; font-size:28px; }
  .menu{ display:flex; gap:18px; justify-content:center; flex-wrap:wrap; margin-bottom:18px; }
  .menu button{
    padding:18px 36px; font-size:20px; background:var(--gold); color:#111;
    border:none; border-radius:12px; font-weight:bold; cursor:pointer;
    transition: transform .12s ease, background .12s ease; min-width:190px;
  }
  .menu button:hover{ background:#c6b142; transform:translateY(-2px); }

  .container{
    display:none; max-width:980px; margin: 12px auto; background: var(--panel-bg);
    border-radius:12px; padding:18px; text-align:right; box-sizing:border-box;
  }
  .container.active{ display:block; }
  .container h2{ margin-top:0; color:var(--gold); }

  label{ display:block; margin:10px 0 6px; font-weight:bold; text-align:right; }
  input[type="text"], input[type="number"], select, textarea{
    width:100%; padding:10px; border-radius:8px; border:1px solid var(--gold);
    background:var(--bg); color:var(--gold); font-size:15px; box-sizing:border-box;
  }
  .time-group{ display:flex; gap:8px; }
  .time-group input, .time-group select{ flex:1; }

  .button-row{ display:flex; gap:12px; justify-content:center; margin-top:14px; flex-wrap:wrap; }
  .btn{ padding:12px 22px; background:var(--gold); color:#111; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
  .btn:hover{ background:#c6b142; }

  .output{
    display:none; margin-top:14px; background:#333; padding:14px; border-radius:8px;
    color:var(--gold); text-align:left; white-space:pre-wrap; direction:ltr;
    max-width:940px; margin-left:auto; margin-right:auto; box-sizing:border-box;
  }

  .custom-dropdown{ position:relative; user-select:none; }
  .cd-selected{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:10px; border-radius:8px; border:1px solid var(--gold);
    background:var(--bg); color:var(--gold); cursor:pointer;
  }
  .cd-selected .placeholder{ opacity:0.8; }
  .cd-panel{
    position:absolute; z-index:9999; left:0; right:0; top:calc(100% + 6px);
    background:var(--bg); border:1px solid rgba(224,202,81,0.15); border-radius:8px;
    box-shadow:0 6px 20px rgba(0,0,0,0.5); max-height:300px; overflow:auto; padding:6px; display:none;
  }
  .cd-option{ padding:10px; border-radius:6px; color:var(--gold); cursor:pointer; text-align:right; }
  .cd-option:hover{ background: rgba(224,202,81,0.06); }
  .cd-option.selected{ background: rgba(224,202,81,0.14); }

  @media (max-width:720px){
    .menu button{ padding:14px 18px; font-size:18px; min-width:140px; }
    .cd-panel{ max-height:260px; }
  }
</style>
</head>
<body>

<h1>📋 الشؤون الإدارية📋</h1>

<div class="menu">
  <button onclick="show('vacBox')">الإجازات و الانتدابات</button>
  <button onclick="show('resignBox')">الاستقالة</button>
  <button onclick="show('violBox')">المخالفات</button>
  <button onclick="show('absBox')">فني لم يحضر</button>
  <button onclick="show('extBox')">إجازة خارجية</button>
</div>

<!-- ================= VACATION (إجازات + الانتدابات) ================= -->
<div id="vacBox" class="container">
  <h2>🧳 الإجازات و الانتدابات 🧳</h2>

  <label>الإجازة لمن؟</label>
  <select id="vac_vacType" onchange="vac_toggleFields()">
    <option value="فني">فني</option>
    <option value="مشرف">مشرف</option>
    <option value="الانتدابات">الانتدابات</option>
  </select>

  <!-- ===== حقول الإجازة الداخلية ===== -->
  <div id="vac_internalFields">
    <label>الكوبي ايدي</label>
    <input type="number" id="vac_copyId" placeholder="أدخل الكوبي ايدي">

    <label>المــــدة (بالساعات)</label>
    <input type="number" id="vac_duration" placeholder="عدد الساعات">

    <label>الرصيد المتبقي (بالساعات)</label>
    <input type="number" id="vac_balance" placeholder="عدد الساعات">

    <label>وقت بدء الإجازة</label>
    <div class="time-group">
      <input type="number" id="vac_startHour" placeholder="الساعة (1-12)">
      <input type="number" id="vac_startMinute" placeholder="الدقيقة (0-59)">
      <select id="vac_startPeriod">
        <option value="ص">صباحًا</option>
        <option value="م">مساءً</option>
      </select>
    </div>
  </div>

  <!-- ===== حقول الانتدابات ===== -->
  <div id="vac_secondmentFields" style="display:none">
    <label>الكوبي ايدي</label>
    <input type="number" id="sec_copyId" placeholder="أدخل الكوبي ايدي">

    <label>اسم المنتدب و كوده</label>
    <input type="text" id="sec_nameCode" placeholder="اكتب الاسم والكود">

    <label>القطاع المنتدب له</label>
    <select id="sec_sector">
      <option value="">اختر القطاع</option>
      <option>آمن الطرق</option>
      <option>آمن المنشآت</option>
      <option>حرس الحدود</option>
      <option>الهلال الأحمر</option>
      <option>آمن عام</option>
      <option>قوات الطؤارئ</option>
    </select>

    <label>المدة (بالأيام)</label>
    <input type="number" id="sec_days" placeholder="عدد الأيام">
  </div>

  <div class="button-row">
    <button class="btn" onclick="vac_generateVacation()">إنشاء الإجازة</button>
    <button class="btn" onclick="vac_copyResult()">📋 نسخ النتيجة</button>
  </div>

  <div id="vac_output" class="output"></div>
</div>

<!-- ================= RESIGNATION (الاستقالة) ================= -->
<div id="resignBox" class="container">
  <h2>📞نموذج الاستقالة📞</h2>

  <label>استقالة لمن ؟</label>
  <select id="res_type" onchange="res_toggleLevel()">
    <option value="مستوى متدرب">مستوى متدرب</option>
    <option value="مستوى 1">مستوى 1</option>
    <option value="اعلى">مستوى 2 فأعلى</option>
  </select>

  <label>الكوبي ايدي</label>
  <input type="number" id="res_copyId" placeholder="أدخل الكوبي ايدي">

  <div id="res_levelBox" style="display:none">
    <label>رقم المستوى (2 فأعلى)</label>
    <input type="number" id="res_levelNumber" min="2" placeholder="أدخل رقم المستوى">
  </div>

  <label>اسم وكود الفني كتابتا</label>
  <input type="text" id="res_nameCode" placeholder="اكتب الاسم والكود كتابتاً">

  <label>كوبي ايدي المشرف</label>
  <input type="number" id="res_supervisorId" placeholder="أدخل كوبي ايدي المشرف">

  <div class="button-row">
    <button class="btn" onclick="res_generate()">إنشاء الرسالة</button>
    <button class="btn" onclick="res_copy()">📋 نسخ النتيجة</button>
  </div>
  <div id="res_output" class="output"></div>
</div>

<!-- ================= VIOLATIONS (المخالفات) ================= -->
<div id="violBox" class="container">
  <h2>📋المخالفات📋</h2>

  <label>الكوبي ايدي</label>
  <input type="number" id="vio_copyId" placeholder="أدخل الكوبي ايدي">

  <label>رقم الإنذار الوظيفي</label>
  <select id="vio_warningLevel" onchange="vio_toggleByLevel()">
    <option value="شفهي">شفهي</option>
    <option value="اول">اول</option>
    <option value="ثاني">ثاني</option>
    <option value="نهائي">نهائي</option>
  </select>

  <div id="vio_fineRow">
    <label>قيمة الغرامة</label>
    <input type="number" id="vio_fineAmount" placeholder="أدخل قيمة الغرامة">
  </div>

  <div id="vio_supervisorRow">
    <label>كوبي ايدي المشرف</label>
    <input type="number" id="vio_supervisorId" placeholder="أدخل كوبي ايدي المشرف">
  </div>

  <label>المخالفات</label>
  <div class="custom-dropdown" id="vio_dropdown">
    <div class="cd-selected" onclick="toggleDropdown('vio')">
      <span class="placeholder">اختر المخالفة</span>
      <span>&#9662;</span>
    </div>
    <div class="cd-panel" id="vio_panel" role="listbox" aria-hidden="true">
      <!-- نفس القائمة الطويلة -->
      <div class="cd-option">التهرب من المحاسبة</div>
      <div class="cd-option">استخدام خواص الميكانيك للمصلحة الشخصية</div>
      <div class="cd-option">عدم احترام  الميكانيكي او القيادة او المشرف</div>
      <div class="cd-option">استقاله برتبة مستوى متدرب او مستوى 1</div>
      <div class="cd-option">اثاره الجدل بالشات العام او رسائل الميكانيك</div>
      <div class="cd-option">أي تلاعب بالفواتير</div>
      <div class="cd-option">استخراج مركبات او استئجار دباب بهدف الحجز</div>
      <div class="cd-option">الاجرام بوظيف الميكانيك</div>
      <div class="cd-option">تواجد في مدن اخرا</div>
      <div class="cd-option">الخروج من غرفة العمليات دون تسليم لجميع المهام الميدانية ( العمليات + النائب + الاتصالات)</div>
      <div class="cd-option">دخول موجه الرقابة والتفتيش</div>
      <div class="cd-option">السجن الرقابي</div>
      <div class="cd-option">عدم احترام افراد القطاعات و المواطنين - التهرب من تنبيهات المشرف</div>
      <div class="cd-option">التصديم المتعمد لغرض تعديل المركبه</div>
      <div class="cd-option">عدم الجدية بالميدان</div>
      <div class="cd-option">تخطي مراجع</div>
      <div class="cd-option">حيازه سلاح او ممنوعات</div>
      <div class="cd-option">مخالفات التعديل و التزويد</div>
      <div class="cd-option">تعديل و تزويد المركبات التي تملك اكسسوارات أو أكسترا اسلحة</div>
      <div class="cd-option">فحص او تعديل و تزويد المركبات في خارج اوقات الافتتاح</div>
      <div class="cd-option">التلاعب في مسارات التعديل و التزويد</div>
      <div class="cd-option">مخالفة قوانين التعديل و التزويد (تعديل مركبة بدون توجيه)</div>
      <div class="cd-option">مخالفة قوانين التعديل و التزويد</div>
      <div class="cd-option">مخالفة قوانين التعديل و التزويد (عدم مراجعة التقرير بعد ارساله )</div>
      <div class="cd-option">تعديل و تزويد المركبة الخاصه بـ المهندس بنفسه</div>
      <div class="cd-option">الصفع او الضرب</div>
      <div class="cd-option">الانتداب وقت التوظيف</div>
      <div class="cd-option">دخول روم الكادر النسائي</div>
      <div class="cd-option">التدخل في الشؤون الأداريه</div>
      <div class="cd-option">تعديل الزي الرسمي للقطاع او اضافه الوشوم</div>
      <div class="cd-option">الاعتراض على الترقية او مخالفة بدون التحقق من اكمال الشروط</div>
      <div class="cd-option">فتح تكت اجازة غير مطابقة للشروط</div>
      <div class="cd-option">التاخر في العودة من الاجازة الداخلية</div>
      <div class="cd-option">تغيير الوظيفة قبل ابتداء الاجازة الداخلية</div>
      <div class="cd-option">التهرب من استلام مهام العمليات او نائب العمليات او مركز الاتصالات</div>
      <div class="cd-option">انزال السطحة اثناء القيادة</div>
      <div class="cd-option">اصلاح المركبات من خلال قائمة F6 ( بإستثناء المركبات الحكومية )</div>
      <div class="cd-option">ترك البوابات الكراج مفتوحة</div>
      <div class="cd-option">تخطي مراجع في الراديو</div>
      <div class="cd-option">القفز من الدرج داخل SRT</div>
      <div class="cd-option">عدم الاستجابة للاستدعاء من قبل المشرفين خلال 24 ساعة</div>
      <div class="cd-option">عدم اخذ كود 7 و التأفيك</div>
      <div class="cd-option">التسطيح داخل حجز لوس دون توجيه</div>
      <div class="cd-option">التوجه للأماكن المحضوره دون توجيه</div>
      <div class="cd-option">القيادة المتهورة</div>
      <div class="cd-option">عدم مطابقة الاسم + الاسم في فايف ام</div>
      <div class="cd-option">التسطيح داخل نداء الاستغاثة</div>
      <div class="cd-option">اهمال مركبة</div>
      <div class="cd-option">عدم الاستجابة على الراديو - عدم تطبيق توجيهات العمليات او النائب</div>
      <div class="cd-option">عدم الالتزام في قائمة اسعار الكراج</div>
      <div class="cd-option">اخذ كود 7 و عدم الرجوع بعد الوقت المحدد</div>
      <div class="cd-option">عدم تسجيل الدخول في الوظيفة</div>
      <div class="cd-option">البقاء في روم الكراج</div>
      <div class="cd-option">عدم دخول الموجة</div>
    </div>
  </div>
  <input type="hidden" id="vio_selected" value="">

  <div class="button-row">
    <button class="btn" onclick="vio_generate()">إنشاء الإنذار</button>
    <button class="btn" onclick="vio_copy()">📋 نسخ النتيجة</button>
  </div>

  <div id="vio_output" class="output"></div>
</div>

<!-- ================= ABSENT (فني لم يحضر) ================= -->
<div id="absBox" class="container">
  <h2>🧲نموذج إستدعاء للفني الذي لم يحضر🧲</h2>

  <label>الكوبي ايدي:</label>
  <input type="number" id="abs_copyId" placeholder="أدخل الكوبي ايدي">

  <label>سبب الاستدعاء:</label>
  <div class="custom-dropdown" id="abs_dropdown">
    <div class="cd-selected" onclick="toggleDropdown('abs')">
      <span class="placeholder">اختر السبب</span>
      <span>&#9662;</span>
    </div>
    <div class="cd-panel" id="abs_panel" role="listbox" aria-hidden="true">
      <!-- نفس القائمة الطويلة (محذوفة هنا للاختصار) -->
      <div class="cd-option">التهرب من المحاسبة</div>
      <!-- ... -->
      <div class="cd-option">عدم دخول الموجة</div>
    </div>
  </div>
  <input type="hidden" id="abs_selected" value="">

  <label>قيمة المخالفة:</label>
  <input type="number" id="abs_penalty" placeholder="أدخل قيمة المخالفة">

  <label>الإنذار المستحق؟</label>
  <select id="abs_warning">
    <option value="">اختر الإنذار</option>
    <option>شفهي</option>
    <option>اول</option>
    <option>ثاني</option>
    <option>نهائي</option>
  </select>

  <label>لم تتم مخالفته بسبب:</label>
  <input type="text" id="abs_notPunished" placeholder="أدخل السبب">

  <div class="button-row">
    <button class="btn" onclick="abs_generate()">إنشاء الرسالة</button>
    <button class="btn" onclick="abs_copy()">نسخ</button>
  </div>

  <div id="abs_output" class="output"></div>
</div>

<!-- ================= EXTERNAL VACATION (إجازة خارجية) ================= -->
<div id="extBox" class="container">
  <h2>✈️نموذج إجازة خارجية✈️</h2>

  <!-- جديد: الاجازة لمن؟ -->
  <label>الاجازة لمن؟</label>
  <select id="ext_personType">
    <option value="فني">فني</option>
    <option value="مشرف">مشرف</option>
  </select>

  <label>الكوبي ايدي</label>
  <input type="number" id="ext_copyId" placeholder="أدخل الكوبي ايدي">

  <label>مدة الاجاز بالايام</label>
  <input type="number" id="ext_days" placeholder="عدد الأيام">

  <div class="button-row">
    <button class="btn" onclick="ext_generate()">إنشاء الإجازة الخارجية</button>
    <button class="btn" onclick="ext_copy()">نسخ</button>
  </div>

  <div id="ext_output" class="output"></div>
</div>

<script>
/* ---------- UI helpers ---------- */
function show(id){
  document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
  const el=document.getElementById(id);
  if(el) el.classList.add('active');
  closeAllDropdowns();
}

/* ---------- custom dropdown behavior ---------- */
function toggleDropdown(name){
  const panel = document.getElementById(name + '_panel');
  const isOpen = panel.style.display === 'block';
  closeAllDropdowns();
  if(!isOpen){
    panel.style.display = 'block';
    panel.setAttribute('aria-hidden','false');
  }
}
function closeAllDropdowns(){
  document.querySelectorAll('.cd-panel').forEach(p=>{ p.style.display='none'; p.setAttribute('aria-hidden','true'); });
}
document.addEventListener('click', function(e){
  if(e.target.closest('#vio_panel') && e.target.classList.contains('cd-option')){
    const val = e.target.innerText.trim();
    document.getElementById('vio_selected').value = val;
    const sel = document.querySelector('#vio_dropdown .cd-selected .placeholder');
    if(sel) sel.innerText = val;
    document.querySelectorAll('#vio_panel .cd-option').forEach(o=>o.classList.remove('selected'));
    e.target.classList.add('selected');
    closeAllDropdowns();
    e.stopPropagation();
    return;
  }
  if(e.target.closest('#abs_panel') && e.target.classList.contains('cd-option')){
    const val = e.target.innerText.trim();
    document.getElementById('abs_selected').value = val;
    const sel = document.querySelector('#abs_dropdown .cd-selected .placeholder');
    if(sel) sel.innerText = val;
    document.querySelectorAll('#abs_panel .cd-option').forEach(o=>o.classList.remove('selected'));
    e.target.classList.add('selected');
    closeAllDropdowns();
    e.stopPropagation();
    return;
  }
  if(!e.target.closest('.custom-dropdown')) closeAllDropdowns();
});
document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeAllDropdowns(); });

/* ---------- VACATION: toggle ---------- */
function vac_toggleFields(){
  const type = document.getElementById('vac_vacType').value;
  const internal = document.getElementById('vac_internalFields');
  const secondment = document.getElementById('vac_secondmentFields');
  if(type === 'الانتدابات'){ internal.style.display='none'; secondment.style.display='block'; }
  else{ internal.style.display='block'; secondment.style.display='none'; }
}

/* ---------- VIOLATIONS: hide fine on "شفهي" ---------- */
function vio_toggleByLevel(){
  const level = document.getElementById('vio_warningLevel').value;
  const fineRow = document.getElementById('vio_fineRow');
  fineRow.style.display = (level === 'شفهي') ? 'none' : 'block';
}
vio_toggleByLevel();

/* ---------- VACATION (internal + secondment) ---------- */
function vac_generateVacation(){
  const type = document.getElementById('vac_vacType').value;

  if(type === 'الانتدابات'){
    const copyId = (document.getElementById('sec_copyId').value || '').trim();
    const nameCode = (document.getElementById('sec_nameCode').value || '').trim();
    const sector = document.getElementById('sec_sector').value;
    const days = (document.getElementById('sec_days').value || '').trim();

    if(!copyId || !nameCode || !sector || !days){
      alert("⚠️ يرجى تعبئة جميع حقول الانتدابات: الكوبي ايدي، اسم المنتدب وكوده، القطاع المنتدب له، المدة");
      return;
    }

    const result =
`*** ▬▬▬ ﷽ ▬▬
\`\`\`الموضوع : انتداب خارجي \`\`\`
السلام عليكم ورحمة الله وبركاته، وبعد:
 \`\`\`cs
# إشارة إلى طلب الموظف الموضحة بياناته أدناه بشأن الانتداب خارج الكراج، نفيدكم بأنه تمت الموافقة على طلبه وفق التفاصيل التالية:
\`\`\`

 الاسم: <@${copyId}>
 اسم وكود الموظف : ${nameCode}
 القطاع المنتدب له: ${sector}
 المدة: ${days} يوم

نرجوا من الموظف التقيد بالأنظمة والتعليمات الخاصة بالانتدابات، والتنسيق مع الجهة المعنية قبل المباشرة.


<@&1149742928953086105> ***`;
    const out = document.getElementById('vac_output');
    out.innerText = result; out.style.display='block';
    return;
  }

  const copyId = document.getElementById('vac_copyId').value.trim();
  const duration = parseInt(document.getElementById('vac_duration').value) || 0;
  const balance = parseInt(document.getElementById('vac_balance').value) || 0;
  let startHour = parseInt(document.getElementById('vac_startHour').value) || 0;
  let startMinute = parseInt(document.getElementById('vac_startMinute').value) || 0;
  const period = document.getElementById('vac_startPeriod').value;

  if(!copyId || duration <= 0 || balance <= 0 || startHour <= 0){
    alert("⚠️ يرجى إدخال جميع الحقول بشكل صحيح"); return;
  }

  if(period === "م" && startHour < 12) startHour += 12;
  if(period === "ص" && startHour === 12) startHour = 0;

  let tzDate = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Riyadh" })); 
  let yyyy = tzDate.getFullYear();
  let mm = String(tzDate.getMonth()+1).padStart(2,'0');
  let dd = String(tzDate.getDate()).padStart(2,'0');

  let startDate = new Date(`${yyyy}-${mm}-${dd}T${String(startHour).padStart(2,'0')}:${String(startMinute).padStart(2,'0')}:00`);
  let endDate = new Date(startDate); endDate.setHours(endDate.getHours() + duration);

  function formatDate(date){
    let y=date.getFullYear(), m=String(date.getMonth()+1).padStart(2,'0'), d=String(date.getDate()).padStart(2,'0');
    let h=date.getHours(), min=String(date.getMinutes()).padStart(2,'0');
    let per=h>=12?"م":"ص"; h=h%12; h=h?h:12;
    return `${y}/${m}/${d}| ${h}:${min}${per}`;
  }

  const headerText = type === "فني" ? "الفني المحترم" : "المشرف المحترم";

  const result =
`***\` إجازة داخلية \`*** 

***\`${headerText} :\`***  <@${copyId}>   

***\`المــــدة :\` ${duration} ساعة***  

***\`الرصيد المتبقي :\` ${balance - duration} ساعة***  

***من تاريخ ${formatDate(startDate)}***  
***الى تاريخ ${formatDate(endDate)}***  

***\`ملاحظة :\`***  
***تنتهي اجازتك بنفس التوقيت اللي بترجع فية .***  

***\`تنويهات هامة يجب قرائتها :\`***  

***01/ تبدأ الإجازة الخاصة بك في وقتها المحدد، ويُمنع تغيير الوظيفة قبل المدة المحددة لبدء الإجازة.***  

***02/ يجب العودة من الإجازة قبل انتهاء مدتها وتغيير الوظيفة إلى قطاع الميكانيك. من يخالف ذلك سيُعتبر تهرباً وظيفياً وستتم محاسبته من قِبل إدارة الكراج.***  

***03/ في حال عندك عذر وقدمته بفتح تكت اجازة سيتم فقط تصفير اجازاتك مهما كان السبب وعدم اعطائك تهرب وظيفي***  

***04/ في حال تم سجنك رقابيا سيتم تطبيق العقوبه عليك حسب [قوانين الاجازات](https://ptb.discord.com/channels/1071933157097615480/1071934713524133918/1416990256070135900) ***  

***كذلك في حال تعديت نص الاسبوع ( الثلاثاء ) او كان رصيدك اقل من نص اجماليك سيتم تصفيرك الاسبوع الحالي والقادم***  

***05/يمنع منعاً باتاً تغيير الاسم داخل المقاطعة حسب [قوانين الاجازات](https://ptb.discord.com/channels/1071933157097615480/1071934713524133918/1416990256070135900) ***

<@&1149742928953086105>`;
  const out = document.getElementById('vac_output');
  out.innerText = result; out.style.display='block';
}

/* ---------- RESIGNATION ---------- */
function res_toggleLevel(){
  const t = document.getElementById('res_type').value;
  document.getElementById('res_levelBox').style.display = (t==='اعلى') ? 'block' : 'none';
}
function res_generate(){
  const type = document.getElementById('res_type').value;
  const copyId = (document.getElementById('res_copyId').value || '').trim();
  const nameCode = (document.getElementById('res_nameCode').value || '').trim();
  const supervisorId = (document.getElementById('res_supervisorId').value || '').trim();
  const levelNumber = (document.getElementById('res_levelNumber').value || '').trim();

  if(!copyId){ alert("⚠️ يرجى إدخال الكوبي ايدي"); return; }
  if(!nameCode){ alert("⚠️ يرجى إدخال اسم وكود الفني كتابتاً"); return; }
  if(!supervisorId){ alert("⚠️ يرجى إدخال كوبي ايدي المشرف"); return; }

  if(type === 'مستوى متدرب' || type === 'مستوى 1'){
    const reasonLine = (type === 'مستوى متدرب')
      ? "استقالة برتبة مستوى (متدرب )"
      : "استقالة برتبة مستوى ( 1)";

    const result =
`*** ▬▬▬ ﷽ ▬▬
\`\`\`diff

-الموضوع : قرار انهاء خدمات
\`\`\`
\`\`\`cs
# بعد الاطلاع على نظام التوظيف والترقيات وانهاء الخدمة الصادر من ادارة الكراج قررنا مايلي 
 
اولاً: تنهى خدمات الفني ادناه اعتبارا من تاريخه
ثانياً: منع توظيف 14 يوم
ثالثاً:غرامه مالية قدرها 1,000,000 تسلم الى خزينة الكراج
\`\`\`

<@${copyId}>
${nameCode}

\`\`\`وذلك بسبب : ${reasonLine} \`\`\`

\`نوع السحب : \`  [فاتورة](رابط الفاتورة) 

\`اعتماد:\` <@${supervisorId}>

\`توقيع مدير الخزينة: \`
<@1182445629721563177> 
<@&1071933343123386429> 

يرسل الاصل الى : 
<@&1149742928953086105> ***`;
    const out = document.getElementById('res_output');
    out.innerText = result; out.style.display='block';
    return;
  }

  if(type === 'اعلى'){
    if(!levelNumber || parseInt(levelNumber,10) < 2){
      alert("⚠️ أدخل رقم مستوى صالح (2 فأعلى)"); return;
    }
    const resultHigh =
`*** ▬▬▬ ﷽ ▬▬
\`\`\`diff

-الموضوع : قرار انهاء خدمات
\`\`\`
\`\`\`cs
# بعد الاطلاع على نظام التوظيف والترقيات وانهاء الخدمة الصادر من ادارة الكراج قررنا مايلي 
 
اولاً: تنهى خدمات الفني ادناه اعتبارا من تاريخه\`\`\`

<@${copyId}>
${nameCode}

\`\`\`وذلك بسبب : استقالة برتبة مستوى (${levelNumber}) بناءاً على طلبه \`\`\`

\`توقيع واعتماد:\`
<@${supervisorId}>

\`يرسل الاصل الى : \`
<@&1149742928953086105> ***`;
    const out = document.getElementById('res_output');
    out.innerText = resultHigh; out.style.display='block';
    return;
  }
}
function res_copy(){
  const out = document.getElementById('res_output');
  if(!out || !out.innerText.trim()){ alert("⚠️ لا يوجد نتيجة لنسخها"); return; }
  navigator.clipboard.writeText(out.innerText).then(()=>alert("✅ تم النسخ"));
}

/* ---------- VIOLATIONS (المخالفات) ---------- */
function vio_generate(){
  const copyId = (document.getElementById('vio_copyId').value || '').trim();
  const warningLevel = document.getElementById('vio_warningLevel').value;
  const fineAmount = (document.getElementById('vio_fineAmount')?.value || '').trim();
  const violation = document.getElementById('vio_selected').value || '';
  const supervisorId = (document.getElementById('vio_supervisorId')?.value || '').trim();

  if(!copyId){ alert("⚠️ يرجى إدخال الكوبي ايدي"); return; }
  if(!violation){ alert("⚠️ يرجى اختيار سبب المخالفة"); return; }
  if(!supervisorId){ alert("⚠️ يرجى إدخال كوبي ايدي المشرف"); return; }

  if(warningLevel === 'شفهي'){
    const resultShafahi =
`▬▬▬ ﷽ ▬▬
\`\`\`diff

-الموضوع : انذار (شفهي) 
\`\`\`
\`\`\`cs
# بعد الاطلاع على نظام المخالفات والعقوبات الصادر من ادارة الكراج قررنا مايلي 
 
اولاً: انذار (شفهي) 
\`\`\`

 الكوبي ايدي للفني <@${copyId}>

\`\`\`وذلك بسبب :  ${violation}\`\`\`


\`اعتماد:\` <@${supervisorId}>`;
    const out = document.getElementById('vio_output');
    out.innerText = resultShafahi; out.style.display='block';
    return;
  }

  if(!fineAmount){ alert("⚠️ يرجى إدخال قيمة الغرامة"); return; }

  const result =
`*** ▬▬▬ ﷽ ▬▬
\`\`\`diff

-الموضوع : انذار وظيفي وغرامه مالية
\`\`\`
\`\`\`cs
# بعد الاطلاع على نظام المخالفات والعقوبات الصادر من ادارة الكراج قررنا مايلي 
 
اولاً: انذار وظيفي (${warningLevel})
ثانياً: غرامه مالية قدرها ${fineAmount} تسلم الى خزينة الكراج\`\`\`

<@${copyId}>

\`\`\`وذلك بسبب : ${violation}\`\`\`

\`نوع السحب : \`  [فاتورة](رابط الفاتورة) 

\`اعتماد:\` <@${supervisorId}>

\`توقيع مدير الخزينة \`
<@1182445629721563177> 
<@&1071933343123386429> 

يرسل الاصل الى : 
<@&1149742928953086105> ***`;
  const out = document.getElementById('vio_output');
  out.innerText = result; out.style.display='block';
}
function vio_copy(){
  const out = document.getElementById('vio_output');
  if(!out || !out.innerText.trim()){ alert("⚠️ لا يوجد نتيجة لنسخها"); return; }
  navigator.clipboard.writeText(out.innerText).then(()=>alert("✅ تم النسخ"));
}

/* ---------- ABSENT (فني لم يحضر) ---------- */
function abs_generate(){
  const copyId = document.getElementById('abs_copyId').value.trim();
  const reason = document.getElementById('abs_selected').value || '';
  const penalty = document.getElementById('abs_penalty').value.trim();
  const warning = document.getElementById('abs_warning').value;
  const notPunished = document.getElementById('abs_notPunished').value.trim();

  if(!copyId || !reason || !penalty || !warning){
    alert("يرجى ملء جميع الحقول المطلوبة"); return;
  }

  const resultText =
`***\`  نموذج إستدعاء للفني الذي لم يحضر  \`***

***\`اسم الفني\`***  <@${copyId}>

***\`سبب الاستدعاء \`***   ${reason}

***\`قيمة المخالفة\`*** ${Number(penalty).toLocaleString()}

***\` الانذار المستحق ؟ : \`*** ${warning}

***\`لم تتم مخالفته بسبب\`*** ${notPunished}

***الي يجيه الفني يعلمه سبب المخالفة  وينزله المخالفة في روم
https://ptb.discord.com/channels/1071933157097615480/1071934723858894868 ***  

***نسخه الى***
 <@&1071933357136556183>  - <@&1142626431101325403>`;
  const out = document.getElementById('abs_output');
  out.innerText = resultText; out.style.display='block';
}
function abs_copy(){
  const out = document.getElementById('abs_output');
  if(!out || !out.innerText.trim()){ alert("⚠️ لا يوجد نتيجة لنسخها"); return; }
  navigator.clipboard.writeText(out.innerText).then(()=>alert("✅ تم النسخ"));
}

/* ---------- EXTERNAL VACATION (إجازة خارجية) ---------- */
function ext_generate(){
  const personType = document.getElementById('ext_personType').value; // جديد
  const headerText = (personType === 'مشرف') ? 'المشرف المحترم' : 'الفني المحترم'; // جديد

  const copyId = document.getElementById('ext_copyId').value.trim();
  const days = parseInt(document.getElementById('ext_days').value,10);
  if(!copyId || !days || days <= 0){ alert("⚠️ يرجى إدخال الكوبي ايدي والمدة بالأيام صحيحة"); return; }

  let tzDate = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Riyadh" }));
  let startDate = new Date(tzDate.getFullYear(), tzDate.getMonth(), tzDate.getDate());
  let endDate = new Date(startDate); endDate.setDate(endDate.getDate() + days);

  function fmtYMD(d){ let y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0'); return `${y}/${m}/${day}`; }

  const result =
`***\`  إجازة خارجية  \`***  

***\`${headerText} :\`***    <@${copyId}>         

***\`المــــدة :\` ${days} يوم***
 
***من تاريخ ${fmtYMD(startDate)}***
*** الى تاريخ ${fmtYMD(endDate)}***

***\`ملاحظة :\`***

***تنتهي اجازتك الخارجية في نفس يوم انتهاء الاجازة.***

***\`تنويهات هامة يجب قرائتها :\`***

***01/ في حال بدت الاجازة يمنع منعا باتا دخولك للمقاطعة. من يخالف ذلك سيُعتبر تهرباً وظيفياً وستتم محاسبته من قِبل إدارة الكراج.***

***02/ في حال انتهاء الاجازة او اردت قطعها يجب فتح تكت اجازة وطلب قطعها او انهائها ويمنع المباشرة حتى ازالة رول اجازة وظيفية***
 
<@&1149742928953086105>`;
  const out = document.getElementById('ext_output');
  out.innerText = result; out.style.display='block';
}
function ext_copy(){
  const out = document.getElementById('ext_output');
  if(!out || !out.innerText.trim()){ alert("⚠️ لا يوجد نتيجة لنسخها"); return; }
  navigator.clipboard.writeText(out.innerText).then(()=>alert("✅ تم النسخ"));
}

/* ---------- default tab ---------- */
show('vacBox');
</script>

</body>
</html>
